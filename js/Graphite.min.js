function is_decimal_point(t){return"."==t}function is_negative_sign(t){return"-"==t}function is_numeric(t){return!isNaN(parseInt(t))}function is_positive(t){return 1/t>0}function flatten(t){return[].concat.apply([],t)}function fillArray(t,i){tempArray=[];for(var e=0;i>e;e++)tempArray.push(t.slice());return tempArray}function updateSlider(t){return t.unlimitedCheckbox[0].checked?(t.dataLengthSlider.slider("disable"),t.chartPlotter.setUnlimited(!0),void(t.isUnlimitedMem=!0)):(t.dataLengthSlider.slider("enable"),t.chartPlotter.setUnlimited(!1),void(t.isUnlimitedMem=!1))}StringScanner=function(t,i){this.delimiter=i||"\n",this.data=t,this.cur=0,this.previousPos=0,this.moveToStartOfNextNumber=function(){for(;!this.reachedEnd();){if(is_numeric(this.current()))return this.cur;if(this.isDelimiter(this.current()))return this.cur;if(this.isStartOfNegativeNumber())return this.cur;this.cur++}return-1},this.isStartOfNegativeNumber=function(){return is_negative_sign(this.current())&&!this.reachedEnd(this.cur+1)&&is_numeric(this.data.charAt(this.cur+1))},this.isDelimiter=function(t){return this.delimiter==t},this.getNextDecimalPart=function(){for(var t=0,i=-1;!this.reachedEnd()&&is_numeric(this.current());)t+=parseInt(this.current())*Math.pow(10,i),i--,this.cur++;return t}},StringScanner.prototype.resetCursor=function(){this.cur=0},StringScanner.prototype.reachedEnd=function(t){var i=t||this.cur;return i>=this.data.length},StringScanner.prototype.nextFloat=function(){this.previousPos=this.cur;var t=this.nextInt();if(null==t)return null;if(this.reachedEnd()||!is_decimal_point(this.current())||this.isDelimiter(this.current()))return t;if(this.cur++,!is_numeric(this.current()))return t;var i=this.getNextDecimalPart();return is_positive(t)?t+i:t-i},StringScanner.prototype.nextInt=function(){this.previousPos=this.cur;var t=this.moveToStartOfNextNumber();if(-1==t)return null;if(this.isDelimiter(this.current()))return this.cur++,null;for(this.cur++;!this.reachedEnd()&&is_numeric(this.current());)this.cur++;return parseInt(this.data.substring(t,this.cur))},StringScanner.prototype.nextChar=function(){return this.reachedEnd()?null:(this.cur++,this.data.charAt(this.cur-1))},StringScanner.prototype.next=function(){for(;this.isDelimiter(this.current())&&!this.reachedEnd();)this.cur++;if(this.reachedEnd())return null;for(var t=this.cur;!this.isDelimiter(this.current())&&!this.reachedEnd();)this.cur++;return this.data.substring(t,this.cur)},StringScanner.prototype.current=function(){return this.data.charAt(this.cur)},StringScanner.prototype.previous=function(){return 0==this.cur?null:this.data.charAt(this.cur-1)},StringScanner.prototype.last=function(){return this.data.charAt(this.data.length-1)},StringScanner.prototype.remaining=function(){return this.data.substring(this.cur)},StringScanner.prototype.rollback=function(){this.cur=this.previousPos},GraphiteDataParser=function(){this.dataStorage=[],this.dataFormat=GraphiteDataParser.ONE_LINER_TYPE,this.currentDisplayedIndex=0,this.pendingData=[],this.variableNumber=1,this.withXCoordinates=!0,this.incompleteNumberSegment=null,this.frequencies={},this.frequencyMax=10,this.isRecordingFrequencies=!0,this.processOneLinerFormat=function(t){if(null!=this.incompleteNumberSegment&&(t=this.incompleteNumberSegment+t,this.incompleteNumberSegment=null),t.indexOf("\n")>-1)return this.dataFormat=GraphiteDataParser.MULTI_LINE_TYPE,this.currentDisplayedIndex=0,this.pendingData=flatten(this.dataStorage),this.dataStorage=[],void this.processMultilineFormat(t);for(var i,e=new StringScanner(t);i=e.nextFloat();){if(e.reachedEnd()){this.processIncompleteSegment(e);break}this.processFrequencies(i),this.dataStorage.push([i])}this.checkNegativeSignEnding(e)},this.processMultilineFormat=function(t){null!=this.incompleteNumberSegment&&(t=this.incompleteNumberSegment+t,this.incompleteNumberSegment=null);for(var i,e=new StringScanner(t);!e.reachedEnd();)if(i=e.nextFloat(),null!=i||"\n"!=e.data.charAt(e.cur-1)){if(e.reachedEnd()){this.processIncompleteSegment(e);break}this.processFrequencies(i),this.pendingData.push(i)}else this.variableNumber=this.pendingData.length,this.dataStorage.push(this.pendingData),this.pendingData=[],this.withXCoordinates&&this.hasIncrementalX();this.checkNegativeSignEnding(e)},this.processFrequencies=function(t){return this.isRecordingFrequencies?void 0==this.frequencies[t]?Object.keys(this.frequencies).length==this.frequencyMax?void(this.isRecordingFrequencies=!1):void(this.frequencies[t]=1):void this.frequencies[t]++:void 0},this.checkNegativeSignEnding=function(t){"-"==t.last()&&(this.incompleteNumberSegment="-")},this.processIncompleteSegment=function(t){t.rollback(),this.incompleteNumberSegment=t.remaining()},this.hasXCoordinates=function(){return this.variableNumber>1?this.withXCoordinates:!1},this.hasIncrementalX=function(){this.dataStorage.length<=1||this.dataStorage[this.dataStorage.length-1][0]<this.dataStorage[this.dataStorage.length-2][0]&&(this.withXCoordinates=!1)}},GraphiteDataParser.ONE_LINER_TYPE=0,GraphiteDataParser.MULTI_LINE_TYPE=1,GraphiteDataParser.MULTI_DATA_WITH_X=2,GraphiteDataParser.prototype.addRawData=function(t){switch(this.dataFormat){case GraphiteDataParser.ONE_LINER_TYPE:this.processOneLinerFormat(t);break;case GraphiteDataParser.MULTI_LINE_TYPE:this.processMultilineFormat(t)}},GraphiteDataParser.prototype.showNewData=function(){return tempList=this.dataStorage.slice(this.currentDisplayedIndex),this.currentDisplayedIndex=this.dataStorage.length,tempList},GraphiteDataParser.prototype.showAllData=function(){return this.dataStorage},GraphiteDataParser.prototype.getvariableNumber=function(){return this.variableNumber||1},GraphiteDataParser.prototype.getFrequencies=function(){return this.isRecordingFrequencies?this.frequencies:null},GraphiteGraphPlotter=function(t){this.div=t,this.chart,this.dataPoints,this.variableNumber,this.withXCoordinates,this.xVal=0,this.dataLength=50,this.dataparser=new GraphiteDataParser,this.isPaused=!1,this.graphType=GraphiteGraphPlotter.LINE_GRAPH,this.dataAmounts,this.dataAverages,this.dataStandardDevs,this.dataMaxs,this.dataMins,this.isUnlimited=!1,this.initLineGraph=function(t,i){this.xVal=0,this.variableNumber=t||1,this.withXCoordinates=i,"undefined"==typeof i&&(this.withXCoordinates=!1);var e=0;i&&(e=1),this.dataPoints=fillArray([],this.variableNumber),this.dataAmounts=Array(this.variableNumber).fill(0),this.dataAverages=Array(this.variableNumber).fill(0),this.dataStandardDevs=Array(this.variableNumber).fill(0),this.dataMaxs=Array(this.variableNumber).fill(-(1/0)),this.dataMins=Array(this.variableNumber).fill(1/0);for(var a=[],r=e;r<this.variableNumber;r++)a.push({type:"line",name:"data"+r,legendText:"data "+(r+1),showInLegend:!0,dataPoints:this.dataPoints[r]});this.chart=new CanvasJS.Chart(this.div,{zoomEnabled:!0,exportEnabled:!0,legend:{cursor:"pointer",itemclick:function(t){"undefined"==typeof t.dataSeries.visible||t.dataSeries.visible?t.dataSeries.visible=!1:t.dataSeries.visible=!0,t.chart.render()}},data:a})},this.initBarGraph=function(){if(this.dataPoints=[],null==this.dataparser.getFrequencies())return void this.switchToLineGraph();for(var t=Object.keys(this.dataparser.getFrequencies()),i=0;i<t.length;i++)this.dataPoints.push({label:t[i],y:this.dataparser.getFrequencies()[t[i]]});this.chart=new CanvasJS.Chart(this.div,{data:[{type:"column",bevelEnabled:!0,dataPoints:this.dataPoints}]}),this.chart.render()},this.updateBarGraph=function(){if(null==this.dataparser.getFrequencies())return void this.switchToLineGraph();for(var t=Object.keys(this.dataparser.getFrequencies()),i=0;i<t.length;i++)this.dataPoints[i]={label:t[i],y:this.dataparser.getFrequencies()[t[i]]};this.chart.render()},this.updateLineGraph=function(t){for(var i=0;i<t.length;i++)if(t[i].length==this.variableNumber){var e=0,a=this.xVal;this.withXCoordinates&&(e=1,a=t[i][0]);for(var r=e;r<this.dataPoints.length;r++)if(this.dataAmounts[r]++,this.dataAverages[r]=(this.dataAverages[r]*(this.dataAmounts[r]-1)+t[i][r])/this.dataAmounts[r],this.dataStandardDevs[r]=Math.sqrt((Math.pow(this.dataStandardDevs[r],2)*(this.dataAmounts[r]-1)+Math.pow(this.dataAverages[r]-t[i][r],2))/this.dataAmounts[r]),this.dataMaxs[r]<t[i][r]&&(this.dataMaxs[r]=t[i][r]),this.dataMins[r]>t[i][r]&&(this.dataMins[r]=t[i][r]),this.dataPoints[r].push({x:a,y:t[i][r]}),!this.isUnlimited)for(;this.dataPoints[r].length>this.dataLength;)this.dataPoints[r].shift();this.xVal++}this.chart.render()},this.initLineGraph()},GraphiteGraphPlotter.prototype.addNewData=function(t){switch(this.dataparser.addRawData(t),this.graphType){case GraphiteGraphPlotter.LINE_GRAPH:differingVariableNumbers=this.variableNumber!=this.dataparser.getvariableNumber(),differingXcoordinateOptions=this.withXCoordinates!=this.dataparser.hasXCoordinates(),(differingVariableNumbers||differingXcoordinateOptions)&&this.initLineGraph(this.dataparser.getvariableNumber(),this.dataparser.hasXCoordinates()),this.isPaused||this.updateLineGraph(this.dataparser.showNewData());break;case GraphiteGraphPlotter.BAR_GRAPH:this.isPaused||this.initBarGraph()}},GraphiteGraphPlotter.LINE_GRAPH=0,GraphiteGraphPlotter.BAR_GRAPH=1,GraphiteGraphPlotter.prototype.switchToLineGraph=function(){this.graphType=GraphiteGraphPlotter.LINE_GRAPH,this.initLineGraph(this.dataparser.getvariableNumber(),this.dataparser.hasXCoordinates())},GraphiteGraphPlotter.prototype.switchToBarGraph=function(){this.graphType=GraphiteGraphPlotter.BAR_GRAPH,this.initBarGraph()},GraphiteGraphPlotter.prototype.pause=function(){this.isPaused=!0},GraphiteGraphPlotter.prototype.unpause=function(){this.isPaused=!1},GraphiteGraphPlotter.prototype.togglePause=function(){this.isPaused=!this.isPaused},GraphiteGraphPlotter.prototype.exportCSV=function(){var t=this.dataparser.showAllData(),i="data:text/csv;charset=utf-8,";t.forEach(function(e,a){dataString=e.join(","),i+=a<t.length?dataString+"\n":dataString});var e=encodeURI(i);window.open(e)},GraphiteGraphPlotter.prototype.isBarChartAvailable=function(){return this.dataparser.isRecordingFrequencies},GraphiteGraphPlotter.prototype.getAverages=function(){return this.dataAverages},GraphiteGraphPlotter.prototype.getStandardDevs=function(){return this.dataStandardDevs},GraphiteGraphPlotter.prototype.getMaxs=function(){return this.dataMaxs},GraphiteGraphPlotter.prototype.getMins=function(){return this.dataMins},GraphiteGraphPlotter.prototype.setDataLength=function(t){this.dataLength=t},GraphiteGraphPlotter.prototype.setUnlimited=function(t){this.isUnlimited=t},Graphite=function(t){this.graphiteConfig=t,this.chartPlotter,this.exportCSVButton,this.switchButton,this.pauseButton,this.dataTable,this.dataLengthSlider,this.unlimitedCheckbox,this.isPaused,this.isUnlimitedMem=!1,this.sampleSizeMem=50,this.variableNumber,"undefined"==typeof t&&(this.graphiteConfig={}),this.initGraphPlotter=function(t){"undefined"==typeof t&&(t="graphite_chart_container"),this.chartPlotter=new GraphiteGraphPlotter(t)},this.initExportCSV=function(t){"undefined"==typeof t&&(t="graphite_export_csv_button");var i=this;this.exportCSVButton=$("#"+t),this.exportCSVButton.unbind(),this.exportCSVButton.on("click",function(){i.chartPlotter.exportCSV()})},this.initLineBarSwitch=function(t){"undefined"==typeof t&&(t="graphite_switch_button"),this.switchButton=$("#"+t),this.switchButton.bootstrapSwitch(),this.switchButton.bootstrapSwitch("disabled",!1);var i=this;this.switchButton.on("switchChange.bootstrapSwitch",function(t,e){return e?void i.chartPlotter.switchToLineGraph():void i.chartPlotter.switchToBarGraph()})},this.initPauseButton=function(t){"undefined"==typeof t&&(t="graphite_pause_button"),this.isPaused=!1,this.pauseButton=$("#"+t),this.pauseButton.text("Pause"),this.pauseButton.attr("class","btn btn-danger btn-block");var i=this;this.pauseButton.unbind(),this.pauseButton.on("click",function(){return i.chartPlotter.togglePause(),i.isPaused?(i.pauseButton.text("Pause"),i.pauseButton.attr("class","btn btn-danger btn-block"),void(i.isPaused=!1)):(i.pauseButton.text("Start"),i.pauseButton.attr("class","btn btn-success btn-block"),void(i.isPaused=!0))})},this.initDataLengthSlider=function(t){"undefined"==typeof t&&(t="graphite_data_length_slider"),this.dataLengthSlider=$("#"+t),this.dataLengthSlider.slider("destroy"),this.dataLengthSlider.slider({scale:"logarithmic"}),this.dataLengthSlider.slider("setValue",this.sampleSizeMem);var i=this;this.dataLengthSlider.on("slide",function(t){i.sampleSizeMem=t.value,i.chartPlotter.setDataLength(t.value)})},this.initUnlimitedCheckbox=function(t){"undefined"==typeof t&&(t="graphite_unlimited_checkbox"),this.unlimitedCheckbox=$("#"+t),this.unlimitedCheckbox.unbind(),this.unlimitedCheckbox.prop("checked",this.isUnlimitedMem),updateSlider(this);var i=this;this.unlimitedCheckbox.click(function(){updateSlider(i)})},this.initDataTable=function(t){"undefined"==typeof t&&(t="graphite_data_table"),this.dataTable=$("#"+t),this.dataTable.empty();var i=$('<tr><th class="col-md-2">Data Number</th><th class="col-md-2">Mean</th><th class="col-md-2">Standard Deviation</th><th class="col-md-2">Maximum</th><th class="col-md-2">Minimum</th></tr>');this.dataTable.append(i)},this.updateDataTable=function(){if(this.variableNumber!=this.chartPlotter.variableNumber){this.variableNumber=this.chartPlotter.variableNumber,this.initDataTable();for(var t=1;t<=this.variableNumber;t++){var i=$("<tr><td>Data"+t+'</td><td class="mean'+t+'"></td><td class="SE'+t+'"></td><td class="max'+t+'"></td><td class="min'+t+'"></td></tr>');this.dataTable.append(i)}}for(var t=0;t<this.variableNumber;t++)$(".mean"+(t+1)).text(""+this.chartPlotter.getAverages()[t].toFixed(5)),$(".SE"+(t+1)).text(""+this.chartPlotter.getStandardDevs()[t].toFixed(5)),$(".max"+(t+1)).text(""+this.chartPlotter.getMaxs()[t]),$(".min"+(t+1)).text(""+this.chartPlotter.getMins()[t])},this.checkBarChartAvailability=function(){this.switchButton[0].checked||this.chartPlotter.isBarChartAvailable()||(this.chartPlotter.switchToLineGraph(),this.switchButton.bootstrapSwitch("state",!0,!0),this.switchButton.bootstrapSwitch("disabled",!0))},this.init=function(){this.initGraphPlotter(this.graphiteConfig.canvas),this.initExportCSV(this.graphiteConfig.exportCSVButton),this.initLineBarSwitch(this.graphiteConfig.switchButton),this.initPauseButton(this.graphiteConfig.pauseButton),this.initDataTable(this.graphiteConfig.dataTable),this.initDataLengthSlider(this.graphiteConfig.dataLengthSlider),this.initUnlimitedCheckbox(this.graphiteConfig.unlimitedCheckbox),this.variableNumber=0},this.init()},Graphite.prototype.addNewData=function(t){var i=/^connect(ing|ed) at .+$/;i.test(t)||(this.updateDataTable(),this.chartPlotter.addNewData(t),this.checkBarChartAvailability())},Graphite.prototype.clearData=function(t){this.init()};